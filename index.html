<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STC Hockey Tracker</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="STC Hockey">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="application-name" content="STC Hockey">
    <meta name="msapplication-TileColor" content="#1e3a8a">
    <meta name="msapplication-tap-highlight" content="no">
    <link rel="apple-touch-icon" href="https://www.chijsttheresasconvent.moe.edu.sg/images/logo.png">
    <link rel="icon" type="image/png" href="https://www.chijsttheresasconvent.moe.edu.sg/images/logo.png">
    <link rel="manifest" href='data:application/json;charset=utf-8,%7B%22name%22%3A%22STC%20Hockey%20Tracker%22%2C%22short_name%22%3A%22STC%20Hockey%22%2C%22description%22%3A%22Track%20your%20hockey%20training%20and%20performance%22%2C%22start_url%22%3A%22.%22%2C%22scope%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22display_override%22%3A%5B%22standalone%22%2C%22minimal-ui%22%5D%2C%22orientation%22%3A%22portrait%22%2C%22background_color%22%3A%22%23f8fafc%22%2C%22theme_color%22%3A%22%231e3a8a%22%2C%22categories%22%3A%5B%22sports%22%2C%22fitness%22%5D%2C%22icons%22%3A%5B%7B%22src%22%3A%22https%3A%2F%2Fwww.chijsttheresasconvent.moe.edu.sg%2Fimages%2Flogo.png%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fpng%22%2C%22purpose%22%3A%22any%20maskable%22%7D%2C%7B%22src%22%3A%22https%3A%2F%2Fwww.chijsttheresasconvent.moe.edu.sg%2Fimages%2Flogo.png%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fpng%22%2C%22purpose%22%3A%22any%20maskable%22%7D%5D%7D'>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        html, body { height: 100%; overflow: hidden; }
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        #root { height: 100%; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input[type="range"] { -webkit-appearance: none; background: transparent; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #1e3a8a; cursor: pointer; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        input[type="range"]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px; }
        .animate-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .main-content { flex: 1; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; min-height: 0; }

        /* Font size scaling using zoom */
        .font-scale-small .main-content { zoom: 0.9; -moz-transform: scale(0.9); -moz-transform-origin: top center; }
        .font-scale-normal .main-content { zoom: 1; }
        .font-scale-large .main-content { zoom: 1.1; -moz-transform: scale(1.1); -moz-transform-origin: top center; }
        .font-scale-xlarge .main-content { zoom: 1.2; -moz-transform: scale(1.2); -moz-transform-origin: top center; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>
    <script>
        (function() {
            var h = React.createElement;
            var useState = React.useState;
            var useMemo = React.useMemo;
            var useEffect = React.useEffect;
            var useRef = React.useRef;

            // Safe storage wrapper for iframe/PWA compatibility
            var storageKey = 'localStorage';
            var safeStorage = {
                _cache: {},
                getItem: function(key) {
                    try {
                        var store = window[storageKey];
                        return store ? store.getItem(key) : this._cache[key] || null;
                    } catch (e) {
                        return this._cache[key] || null;
                    }
                },
                setItem: function(key, value) {
                    try {
                        var store = window[storageKey];
                        if (store) store.setItem(key, value);
                        this._cache[key] = value;
                    } catch (e) {
                        this._cache[key] = value;
                    }
                }
            };

            var LOGO_URL = "https://www.chijsttheresasconvent.moe.edu.sg/images/logo.png";
            var STORAGE_KEY_LOGS = "stc_hockey_logs_vfinal";
            var STORAGE_KEY_PROFILE = "stc_hockey_profile_vfinal";
            var STORAGE_KEY_FONTSIZE = "stc_hockey_fontsize";

            var FONT_SIZES = [
                { id: 'small', name: 'Small', scale: 0.85 },
                { id: 'normal', name: 'Normal', scale: 1 },
                { id: 'large', name: 'Large', scale: 1.15 },
                { id: 'xlarge', name: 'Extra Large', scale: 1.3 }
            ];

            var EXERCISE_TYPES = [
                { id: 'match', name: 'Match', icon: 'ðŸ‘' },
                { id: 'drills', name: 'Drills', icon: 'ðŸŽ¯' },
                { id: 'fitness', name: 'Fitness', icon: 'ðŸƒ' },
                { id: 'strength', name: 'Strength', icon: 'ðŸ’ª' },
                { id: 'recovery', name: 'Recovery', icon: 'ðŸ§˜' },
                { id: 'rest', name: 'Rest', icon: 'ðŸ˜´' }
            ];

            var INTENSITY_LEVELS = [
                { id: 'low', name: 'Low' },
                { id: 'moderate', name: 'Med' },
                { id: 'high', name: 'High' }
            ];

            function getWeekIdentifier(date) {
                var d;
                // Parse date string in local time to avoid timezone issues
                if (typeof date === 'string' && date.indexOf('-') > -1) {
                    var parts = date.split('-');
                    d = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                } else {
                    d = new Date(date);
                }
                var day = d.getDay();
                var diff = d.getDate() - day + (day === 0 ? -6 : 1);
                var weekStart = new Date(d.getFullYear(), d.getMonth(), diff);
                var year = weekStart.getFullYear();
                var month = String(weekStart.getMonth() + 1).padStart(2, '0');
                var dayOfMonth = String(weekStart.getDate()).padStart(2, '0');
                return year + '-' + month + '-' + dayOfMonth;
            }

            function Icon(props) {
                var name = props.name;
                var className = props.className || "w-4 h-4";
                var svgState = useState('');
                var svg = svgState[0];
                var setSvg = svgState[1];

                useEffect(function() {
                    var icon = lucide.icons[name];
                    if (icon) {
                        var svgString = icon.map(function(tag) {
                            var tagName = tag[0];
                            var attrs = tag[1];
                            var attrString = Object.entries(attrs).map(function(kv) {
                                return kv[0] + '="' + kv[1] + '"';
                            }).join(' ');
                            return '<' + tagName + ' ' + attrString + '></' + tagName + '>';
                        }).join('');
                        setSvg(svgString);
                    }
                }, [name]);

                return h('svg', {
                    xmlns: "http://www.w3.org/2000/svg",
                    viewBox: "0 0 24 24",
                    fill: "none",
                    stroke: "currentColor",
                    strokeWidth: "2.5",
                    strokeLinecap: "round",
                    strokeLinejoin: "round",
                    className: className,
                    dangerouslySetInnerHTML: { __html: svg }
                });
            }

            function ConfirmDialog(props) {
                return h('div', { className: "fixed inset-0 bg-slate-900/40 backdrop-blur-[2px] z-[200] flex items-center justify-center p-4" },
                    h('div', { className: "bg-white w-full max-w-sm rounded-2xl p-6 space-y-4 animate-in shadow-xl" },
                        h('div', { className: "flex items-center gap-3" },
                            h('div', { className: "w-10 h-10 rounded-full bg-rose-100 flex items-center justify-center" },
                                h(Icon, { name: "AlertTriangle", className: "w-5 h-5 text-rose-600" })
                            ),
                            h('h3', { className: "text-sm font-bold text-slate-800" }, "Confirm Action")
                        ),
                        h('p', { className: "text-sm text-slate-600" }, props.message),
                        h('div', { className: "flex gap-3 pt-2" },
                            h('button', {
                                onClick: props.onCancel,
                                className: "flex-1 p-3 rounded-xl font-bold text-xs uppercase text-slate-500 bg-slate-100 hover:bg-slate-200 transition-colors"
                            }, "Cancel"),
                            h('button', {
                                onClick: props.onConfirm,
                                className: "flex-1 p-3 rounded-xl font-bold text-xs uppercase text-white bg-rose-500 hover:bg-rose-600 transition-colors"
                            }, "Delete")
                        )
                    )
                );
            }

            function LogItem(props) {
                var log = props.log;
                var onDelete = props.onDelete;
                var type = EXERCISE_TYPES.find(function(t) { return t.id === log.type; }) || {};

                return h('div', { className: "bg-white p-3 rounded-xl border flex items-center justify-between animate-in" },
                    h('div', { className: "flex items-center gap-3" },
                        h('span', { className: "text-lg" }, type.icon),
                        h('div', null,
                            h('p', { className: "font-bold text-xs" }, type.name),
                            h('p', { className: "text-[10px] font-medium text-slate-400" },
                                log.date + ' â€¢ ' + log.duration + 'm â€¢ ' + log.intensity
                            )
                        )
                    ),
                    h('button', {
                        onClick: function() { onDelete(log.id); },
                        className: "text-slate-300 hover:text-rose-500 p-1"
                    },
                        h(Icon, { name: "Trash2", className: "w-3.5 h-3.5" })
                    )
                );
            }

            function NavBtn(props) {
                return h('button', {
                    onClick: props.onClick,
                    className: "p-2.5 rounded-xl transition-all " + (props.active ? 'bg-blue-900 text-white shadow-sm' : 'text-slate-300 hover:text-blue-900')
                },
                    h(Icon, { name: props.icon, className: "w-5 h-5" })
                );
            }

            function App() {
                var logsState = useState(function() {
                    return JSON.parse(safeStorage.getItem(STORAGE_KEY_LOGS) || '[]');
                });
                var logs = logsState[0];
                var setLogs = logsState[1];

                var profileState = useState(function() {
                    return JSON.parse(safeStorage.getItem(STORAGE_KEY_PROFILE) || '{"name":"STC Athlete","position":"Midfielder","jerseyNumber":"07","weeklyGoal":300}');
                });
                var profile = profileState[0];
                var setProfile = profileState[1];

                var tabState = useState('dashboard');
                var activeTab = tabState[0];
                var setActiveTab = tabState[1];

                var modalState = useState(false);
                var showAddModal = modalState[0];
                var setShowAddModal = modalState[1];

                var selectedDateState = useState(new Date().toISOString().split('T')[0]);
                var selectedDate = selectedDateState[0];
                var setSelectedDate = selectedDateState[1];

                var viewDateState = useState(new Date());
                var viewDate = viewDateState[0];
                var setViewDate = viewDateState[1];

                var statusState = useState(null);
                var statusMsg = statusState[0];
                var setStatusMsg = statusState[1];

                var newLogState = useState({
                    type: 'drills',
                    duration: '',
                    intensity: 'moderate',
                    date: new Date().toISOString().split('T')[0]
                });
                var newLog = newLogState[0];
                var setNewLog = newLogState[1];

                var fileInputRef = useRef(null);

                var confirmState = useState(null);
                var confirmDialog = confirmState[0];
                var setConfirmDialog = confirmState[1];

                var expandedMonthsState = useState({});
                var expandedMonths = expandedMonthsState[0];
                var setExpandedMonths = expandedMonthsState[1];

                var installState = useState(null);
                var deferredPrompt = installState[0];
                var setDeferredPrompt = installState[1];

                var bannerState = useState(false);
                var showInstallBanner = bannerState[0];
                var setShowInstallBanner = bannerState[1];

                var iosState = useState(false);
                var isIOS = iosState[0];
                var setIsIOS = iosState[1];

                var standaloneState = useState(false);
                var isStandalone = standaloneState[0];
                var setIsStandalone = standaloneState[1];

                var bugReportState = useState(false);
                var showBugReport = bugReportState[0];
                var setShowBugReport = bugReportState[1];

                var splashState = useState(true);
                var showSplash = splashState[0];
                var setShowSplash = splashState[1];

                var fontSizeState = useState(function() {
                    return safeStorage.getItem(STORAGE_KEY_FONTSIZE) || 'normal';
                });
                var fontSize = fontSizeState[0];
                var setFontSize = fontSizeState[1];

                // Get current font scale
                var fontScale = (FONT_SIZES.find(function(f) { return f.id === fontSize; }) || FONT_SIZES[1]).scale;

                useEffect(function() {
                    safeStorage.setItem(STORAGE_KEY_FONTSIZE, fontSize);
                }, [fontSize]);

                useEffect(function() {
                    // Hide splash after 1.5 seconds
                    var splashTimer = setTimeout(function() {
                        setShowSplash(false);
                    }, 1500);
                    return function() { clearTimeout(splashTimer); };
                }, []);

                useEffect(function() {
                    var standalone = window.matchMedia('(display-mode: standalone)').matches ||
                                     window.matchMedia('(display-mode: fullscreen)').matches ||
                                     window.navigator.standalone === true;
                    setIsStandalone(standalone);

                    var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                    setIsIOS(iOS);

                    if (!standalone) {
                        var handler = function(e) {
                            e.preventDefault();
                            setDeferredPrompt(e);
                            setShowInstallBanner(true);
                        };
                        window.addEventListener('beforeinstallprompt', handler);
                        if (iOS) setShowInstallBanner(true);
                        return function() { window.removeEventListener('beforeinstallprompt', handler); };
                    }
                }, []);

                function handleInstallClick() {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        deferredPrompt.userChoice.then(function(result) {
                            if (result.outcome === 'accepted') {
                                setDeferredPrompt(null);
                                setShowInstallBanner(false);
                            }
                        });
                    } else if (isIOS) {
                        notify("iOS: Tap 'Share' then 'Add to Home Screen'");
                    } else {
                        notify("Use browser menu to 'Install' or 'Add to Home Screen'");
                    }
                }

                useEffect(function() {
                    safeStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs));
                }, [logs]);

                useEffect(function() {
                    safeStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profile));
                }, [profile]);

                function notify(msg) {
                    setStatusMsg(msg);
                    setTimeout(function() { setStatusMsg(null); }, 2500);
                }

                function addLog(e) {
                    e.preventDefault();
                    var durationVal = newLog.type === 'rest' ? 0 : parseInt(newLog.duration || 0);
                    if (newLog.type !== 'rest' && durationVal <= 0) {
                        notify('Invalid duration');
                        return;
                    }
                    var entry = Object.assign({}, newLog, { id: Date.now(), duration: durationVal });
                    var newLogs = [entry].concat(logs).sort(function(a, b) {
                        return new Date(b.date) - new Date(a.date);
                    });
                    setLogs(newLogs);
                    setShowAddModal(false);
                    setNewLog(Object.assign({}, newLog, { duration: '' }));
                    notify('Logged!');
                }

                function deleteLog(id) {
                    setLogs(logs.filter(function(l) { return l.id !== id; }));
                    notify('Deleted');
                }

                function exportData() {
                    var dataStr = JSON.stringify({ logs: logs, profile: profile }, null, 2);
                    var dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                    var linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', 'stc-hockey-data.json');
                    linkElement.click();
                }

                function importData(event) {
                    var file = event.target.files[0];
                    if (!file) return;
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            var json = JSON.parse(e.target.result);
                            if (json.logs) setLogs(json.logs);
                            if (json.profile) setProfile(json.profile);
                            notify('Restored!');
                        } catch (err) {
                            notify('Error reading file');
                        }
                    };
                    reader.readAsText(file);
                }

                function resetAllData() {
                    setConfirmDialog({
                        message: "Delete all history? This action cannot be undone.",
                        onConfirm: function() {
                            setLogs([]);
                            notify('Reset');
                            setConfirmDialog(null);
                        },
                        onCancel: function() { setConfirmDialog(null); }
                    });
                }

                var recoveryInsight = useMemo(function() {
                    var last7Days = logs.filter(function(l) {
                        return (new Date() - new Date(l.date)) / (1000 * 3600 * 24) <= 7;
                    });
                    var highIntensity = last7Days.filter(function(l) { return l.intensity === 'high'; }).length;
                    var restDays = last7Days.filter(function(l) { return l.type === 'rest'; }).length;
                    if (highIntensity >= 3 && restDays < 1) {
                        return { text: "Strain High: Rest recommended.", color: "text-rose-600 bg-rose-50", icon: "AlertCircle" };
                    }
                    if (restDays >= 1) {
                        return { text: "Balanced: Recovery is optimal.", color: "text-emerald-600 bg-emerald-50", icon: "Check" };
                    }
                    return { text: "Log rest days to track recovery.", color: "text-blue-600 bg-blue-50", icon: "Info" };
                }, [logs]);

                var weeklyProgress = useMemo(function() {
                    var currentWeek = getWeekIdentifier(new Date());
                    var weekLogs = logs.filter(function(l) {
                        return getWeekIdentifier(l.date) === currentWeek;
                    });
                    var mins = weekLogs.reduce(function(a, c) { return a + c.duration; }, 0);
                    var restDays = weekLogs.filter(function(l) { return l.type === 'rest'; }).length;
                    var trainingDays = weekLogs.filter(function(l) { return l.type !== 'rest'; }).length;
                    var highIntensity = weekLogs.filter(function(l) { return l.intensity === 'high'; }).length;
                    return {
                        mins: mins,
                        percent: Math.min(100, (mins / profile.weeklyGoal) * 100),
                        restDays: restDays,
                        trainingDays: trainingDays,
                        highIntensity: highIntensity,
                        totalSessions: weekLogs.length
                    };
                }, [logs, profile.weeklyGoal]);

                // Helper to parse date string in local time
                function parseLocalDate(dateStr) {
                    if (typeof dateStr === 'string' && dateStr.indexOf('-') > -1) {
                        var parts = dateStr.split('-');
                        return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                    }
                    return new Date(dateStr);
                }

                // Helper to get week end date (Sunday)
                function getWeekEnd(weekStart) {
                    var end = parseLocalDate(weekStart);
                    end.setDate(end.getDate() + 6);
                    return end;
                }

                // Helper to format date range
                function formatWeekRange(weekStart) {
                    var start = parseLocalDate(weekStart);
                    var end = getWeekEnd(weekStart);
                    var startDay = start.getDate();
                    var endDay = end.getDate();
                    var startMonth = start.toLocaleString('default', { month: 'short' });
                    var endMonth = end.toLocaleString('default', { month: 'short' });
                    if (startMonth === endMonth) {
                        return startDay + ' - ' + endDay + ' ' + startMonth;
                    }
                    return startDay + ' ' + startMonth + ' - ' + endDay + ' ' + endMonth;
                }

                // Get all weeks from start of year to current week
                var weeklyHistory = useMemo(function() {
                    var today = new Date();
                    var currentWeekId = getWeekIdentifier(today);
                    var currentYear = today.getFullYear();

                    // Start from Jan 1 of current year
                    var startDate = new Date(currentYear, 0, 1);
                    var weeks = [];

                    // Generate all weeks from start of year
                    var checkDate = new Date(startDate);
                    while (true) {
                        var weekId = getWeekIdentifier(checkDate);
                        var weekEnd = getWeekEnd(weekId);

                        // Stop if week is in the future
                        if (parseLocalDate(weekId) > today) break;

                        // Calculate minutes for this week
                        var mins = logs.filter(function(l) {
                            return getWeekIdentifier(l.date) === weekId;
                        }).reduce(function(a, c) { return a + c.duration; }, 0);

                        var goalMet = mins >= profile.weeklyGoal;
                        var isCurrent = weekId === currentWeekId;

                        // Get the month this week primarily belongs to (use week start)
                        var weekStartDate = parseLocalDate(weekId);
                        var monthKey = weekStartDate.getFullYear() + '-' + String(weekStartDate.getMonth() + 1).padStart(2, '0');
                        var monthName = weekStartDate.toLocaleString('default', { month: 'long', year: 'numeric' });

                        weeks.push({
                            weekId: weekId,
                            weekRange: formatWeekRange(weekId),
                            mins: mins,
                            goalMet: goalMet,
                            isCurrent: isCurrent,
                            monthKey: monthKey,
                            monthName: monthName,
                            percent: Math.min(100, (mins / profile.weeklyGoal) * 100)
                        });

                        // Move to next week
                        checkDate.setDate(checkDate.getDate() + 7);
                    }

                    return weeks.reverse(); // Most recent first
                }, [logs, profile.weeklyGoal]);

                // Group weeks by month
                var weeksByMonth = useMemo(function() {
                    var grouped = {};
                    var currentMonth = new Date().getFullYear() + '-' + String(new Date().getMonth() + 1).padStart(2, '0');

                    weeklyHistory.forEach(function(week) {
                        if (!grouped[week.monthKey]) {
                            grouped[week.monthKey] = {
                                monthKey: week.monthKey,
                                monthName: week.monthName,
                                weeks: [],
                                isCurrentMonth: week.monthKey === currentMonth
                            };
                        }
                        grouped[week.monthKey].weeks.push(week);
                    });

                    // Convert to array sorted by month (most recent first)
                    return Object.values(grouped).sort(function(a, b) {
                        return b.monthKey.localeCompare(a.monthKey);
                    });
                }, [weeklyHistory]);

                function toggleMonth(monthKey) {
                    var newExpanded = Object.assign({}, expandedMonths);
                    newExpanded[monthKey] = !newExpanded[monthKey];
                    setExpandedMonths(newExpanded);
                }

                function renderDashboard() {
                    return h('div', { className: "space-y-5 animate-in" },
                        h('div', { className: "bg-blue-900 rounded-2xl p-5 text-white shadow-lg" },
                            h('div', { className: "relative z-10" },
                                h('p', { className: "text-[9px] font-bold opacity-70 uppercase tracking-widest mb-0.5" }, "Hockey Player"),
                                h('h2', { className: "text-xl font-extrabold" }, profile.name),
                                h('div', { className: "flex gap-2 mt-3" },
                                    h('div', { className: "bg-white/10 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider" }, profile.position),
                                    h('div', { className: "bg-white/10 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider" }, "#" + profile.jerseyNumber)
                                )
                            )
                        ),
                        h('div', { className: "p-3 rounded-xl flex gap-2.5 items-center border border-transparent " + recoveryInsight.color },
                            h(Icon, { name: recoveryInsight.icon, className: "w-4 h-4" }),
                            h('p', { className: "text-[11px] font-bold" }, recoveryInsight.text)
                        ),
                        h('div', { className: "space-y-2.5" },
                            h('h3', { className: "text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1" }, "Recent Activity"),
                            logs.slice(0, 3).map(function(log) {
                                return h(LogItem, { key: log.id, log: log, onDelete: deleteLog });
                            }),
                            logs.length === 0 && h('p', { className: "text-center py-4 text-slate-300 text-xs italic" }, "No activity yet")
                        )
                    );
                }

                function renderHistory() {
                    var firstDay = new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay();
                    var daysInMonth = new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate();

                    return h('div', { className: "space-y-4 animate-in" },
                        h('div', { className: "bg-white p-4 rounded-2xl border shadow-sm" },
                            h('div', { className: "flex justify-between items-center mb-3 px-1" },
                                h('h3', { className: "font-extrabold text-xs uppercase text-slate-500" },
                                    viewDate.toLocaleString('default', { month: 'long', year: 'numeric' })
                                ),
                                h('div', { className: "flex gap-1" },
                                    h('button', {
                                        onClick: function() { setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1)); },
                                        className: "p-1.5 hover:bg-slate-50 rounded-lg transition-colors"
                                    }, h(Icon, { name: "ChevronLeft" })),
                                    h('button', {
                                        onClick: function() { setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1)); },
                                        className: "p-1.5 hover:bg-slate-50 rounded-lg transition-colors"
                                    }, h(Icon, { name: "ChevronRight" }))
                                )
                            ),
                            h('div', { className: "grid grid-cols-7 gap-0.5 text-center" },
                                ['S','M','T','W','T','F','S'].map(function(d, i) {
                                    return h('span', { key: 'day-' + i, className: "text-[9px] font-bold text-slate-300 py-1" }, d);
                                }),
                                Array.from({ length: firstDay }).map(function(_, i) {
                                    return h('div', { key: 'empty-' + i });
                                }),
                                Array.from({ length: daysInMonth }).map(function(_, i) {
                                    var day = i + 1;
                                    var dStr = viewDate.getFullYear() + '-' + String(viewDate.getMonth() + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
                                    var hasLog = logs.some(function(l) { return l.date === dStr; });
                                    var isSelected = selectedDate === dStr;
                                    var isToday = dStr === new Date().toISOString().split('T')[0];
                                    return h('button', {
                                        key: day,
                                        onClick: function() { setSelectedDate(dStr); },
                                        className: "aspect-square rounded-lg text-xs font-bold flex flex-col items-center justify-center relative " +
                                            (isSelected ? 'bg-blue-900 text-white' : isToday ? 'text-blue-600 bg-blue-50' : 'text-slate-700 hover:bg-slate-50')
                                    },
                                        day,
                                        hasLog && h('div', { className: "w-1 h-1 rounded-full absolute bottom-1 " + (isSelected ? 'bg-white' : 'bg-blue-400') })
                                    );
                                })
                            )
                        ),
                        h('div', { className: "flex flex-col" },
                            h('h4', { className: "text-[10px] font-bold text-slate-400 uppercase px-1 mb-2" }, "Activity for " + selectedDate),
                            h('div', { className: "space-y-2 overflow-y-auto max-h-40", style: { WebkitOverflowScrolling: 'touch' } },
                                logs.filter(function(l) { return l.date === selectedDate; }).map(function(log) {
                                    return h(LogItem, { key: log.id, log: log, onDelete: deleteLog });
                                }),
                                logs.filter(function(l) { return l.date === selectedDate; }).length === 0 &&
                                    h('p', { className: "text-center py-4 text-slate-300 text-[11px] italic" }, "Rest day")
                            )
                        )
                    );
                }

                function renderWeekItem(week) {
                    return h('div', {
                        key: week.weekId,
                        className: "flex items-center justify-between p-3 bg-slate-50 rounded-xl " + (week.isCurrent ? 'ring-2 ring-blue-900' : '')
                    },
                        h('div', { className: "flex items-center gap-3" },
                            h('div', {
                                className: "w-8 h-8 rounded-full flex items-center justify-center " +
                                    (week.isCurrent ? 'bg-blue-100' : week.goalMet ? 'bg-emerald-100' : 'bg-rose-100')
                            },
                                week.isCurrent
                                    ? h(Icon, { name: "Clock", className: "w-4 h-4 text-blue-600" })
                                    : week.goalMet
                                        ? h(Icon, { name: "Check", className: "w-4 h-4 text-emerald-600" })
                                        : h(Icon, { name: "X", className: "w-4 h-4 text-rose-500" })
                            ),
                            h('div', null,
                                h('p', { className: "text-[11px] font-bold text-slate-700" }, week.weekRange),
                                h('p', { className: "text-[9px] text-slate-400" },
                                    week.mins + "m / " + profile.weeklyGoal + "m" +
                                    (week.isCurrent ? " (In Progress)" : week.goalMet ? " âœ“ Goal Met" : " âœ— Goal Missed")
                                )
                            )
                        ),
                        h('div', { className: "w-12 h-1.5 bg-slate-200 rounded-full overflow-hidden" },
                            h('div', {
                                className: "h-full rounded-full transition-all " +
                                    (week.isCurrent ? 'bg-blue-600' : week.goalMet ? 'bg-emerald-500' : 'bg-rose-400'),
                                style: { width: week.percent + '%' }
                            })
                        )
                    );
                }

                function renderMonthGroup(monthData) {
                    var isExpanded = expandedMonths[monthData.monthKey];
                    // Filter out current week for counting (it's shown separately at top)
                    var pastWeeks = monthData.weeks.filter(function(w) { return !w.isCurrent; });
                    var goalsMetCount = pastWeeks.filter(function(w) { return w.goalMet; }).length;
                    var totalWeeks = pastWeeks.length;

                    // Skip if no past weeks to show
                    if (totalWeeks === 0) return null;

                    // All months - collapsible with summary
                    return h('div', { key: monthData.monthKey, className: "space-y-2" },
                        h('button', {
                            onClick: function() { toggleMonth(monthData.monthKey); },
                            className: "w-full flex items-center justify-between p-3 bg-white rounded-xl border shadow-sm hover:bg-slate-50 transition-colors"
                        },
                            h('div', { className: "flex items-center gap-3" },
                                h('div', {
                                    className: "w-8 h-8 rounded-full flex items-center justify-center " +
                                        (goalsMetCount === totalWeeks ? 'bg-emerald-100' : goalsMetCount === 0 ? 'bg-rose-100' : 'bg-amber-100')
                                },
                                    goalsMetCount === totalWeeks
                                        ? h(Icon, { name: "Trophy", className: "w-4 h-4 text-emerald-600" })
                                        : goalsMetCount === 0
                                            ? h(Icon, { name: "Calendar", className: "w-4 h-4 text-rose-500" })
                                            : h(Icon, { name: "Calendar", className: "w-4 h-4 text-amber-600" })
                                ),
                                h('div', { className: "text-left" },
                                    h('p', { className: "text-xs font-bold text-slate-700" }, monthData.monthName),
                                    h('p', { className: "text-[9px] " + (goalsMetCount === totalWeeks ? 'text-emerald-600' : goalsMetCount === 0 ? 'text-rose-500' : 'text-slate-400') },
                                        goalsMetCount + "/" + totalWeeks + " weeks goal met"
                                    )
                                )
                            ),
                            h('div', { className: "flex items-center gap-2" },
                                h('div', { className: "flex gap-1" },
                                    pastWeeks.map(function(w, i) {
                                        return h('div', {
                                            key: i,
                                            className: "w-2 h-2 rounded-full " + (w.goalMet ? 'bg-emerald-400' : 'bg-rose-400')
                                        });
                                    })
                                ),
                                h(Icon, {
                                    name: isExpanded ? "ChevronUp" : "ChevronDown",
                                    className: "w-4 h-4 text-slate-400"
                                })
                            )
                        ),
                        isExpanded && h('div', { className: "space-y-2 mt-2 animate-in" },
                            pastWeeks.map(function(week) {
                                return renderWeekItem(week);
                            })
                        )
                    );
                }

                function renderAnalysis() {
                    var dashOffset = 314.15 - (314.15 * weeklyProgress.percent) / 100;
                    return h('div', { className: "space-y-5 animate-in" },
                        h('div', { className: "bg-white p-6 rounded-3xl border shadow-sm text-center" },
                            h('h3', { className: "text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4" }, "This Week's Progress"),
                            h('div', { className: "relative w-28 h-28 mx-auto flex items-center justify-center mb-4" },
                                h('svg', { className: "w-full h-full -rotate-90" },
                                    h('circle', { cx: "56", cy: "56", r: "50", stroke: "#f1f5f9", strokeWidth: "8", fill: "none" }),
                                    h('circle', {
                                        cx: "56", cy: "56", r: "50", stroke: "#1e3a8a", strokeWidth: "8", fill: "none",
                                        strokeDasharray: "314.15", strokeDashoffset: dashOffset, strokeLinecap: "round",
                                        className: "transition-all duration-700"
                                    })
                                ),
                                h('div', { className: "absolute text-xl font-black text-blue-900" }, Math.round(weeklyProgress.percent) + "%")
                            ),
                            h('p', { className: "text-lg font-extrabold text-blue-900" }, weeklyProgress.mins + " / " + profile.weeklyGoal + "m"),
                            h('p', { className: "text-[10px] font-bold text-slate-400 uppercase tracking-tighter" }, "Minutes logged this week")
                        ),
                        // This Week's Breakdown
                        h('div', { className: "bg-white p-4 rounded-2xl border shadow-sm" },
                            h('h4', { className: "text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3" }, "This Week's Breakdown"),
                            h('div', { className: "grid grid-cols-4 gap-2" },
                                // Training Days
                                h('div', { className: "text-center p-2 bg-blue-50 rounded-xl" },
                                    h('div', { className: "flex justify-center mb-1" },
                                        h(Icon, { name: "Dumbbell", className: "w-4 h-4 text-blue-600" })
                                    ),
                                    h('p', { className: "text-lg font-black text-blue-900" }, weeklyProgress.trainingDays),
                                    h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Training")
                                ),
                                // Rest Days
                                h('div', { className: "text-center p-2 bg-purple-50 rounded-xl" },
                                    h('div', { className: "flex justify-center mb-1" },
                                        h(Icon, { name: "Moon", className: "w-4 h-4 text-purple-600" })
                                    ),
                                    h('p', { className: "text-lg font-black text-purple-900" }, weeklyProgress.restDays),
                                    h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Rest")
                                ),
                                // High Intensity
                                h('div', { className: "text-center p-2 bg-orange-50 rounded-xl" },
                                    h('div', { className: "flex justify-center mb-1" },
                                        h(Icon, { name: "Flame", className: "w-4 h-4 text-orange-600" })
                                    ),
                                    h('p', { className: "text-lg font-black text-orange-900" }, weeklyProgress.highIntensity),
                                    h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "High Int.")
                                ),
                                // Total Sessions
                                h('div', { className: "text-center p-2 bg-slate-100 rounded-xl" },
                                    h('div', { className: "flex justify-center mb-1" },
                                        h(Icon, { name: "Activity", className: "w-4 h-4 text-slate-600" })
                                    ),
                                    h('p', { className: "text-lg font-black text-slate-700" }, weeklyProgress.totalSessions),
                                    h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Sessions")
                                )
                            ),
                            // Recovery Status Bar
                            h('div', { className: "mt-3 pt-3 border-t border-slate-100" },
                                h('div', { className: "flex items-center justify-between" },
                                    h('span', { className: "text-[9px] font-bold text-slate-400 uppercase" }, "Recovery Balance"),
                                    h('span', { className: "text-[9px] font-bold " +
                                        (weeklyProgress.restDays >= 1 ? 'text-emerald-600' : weeklyProgress.highIntensity >= 3 ? 'text-rose-500' : 'text-slate-500') },
                                        weeklyProgress.restDays >= 1 ? "Good" : weeklyProgress.highIntensity >= 3 ? "Rest Needed" : "Moderate"
                                    )
                                ),
                                h('div', { className: "mt-1.5 h-2 bg-slate-100 rounded-full overflow-hidden flex" },
                                    weeklyProgress.trainingDays > 0 && h('div', {
                                        className: "h-full bg-blue-500",
                                        style: { width: (weeklyProgress.trainingDays / 7 * 100) + '%' }
                                    }),
                                    weeklyProgress.restDays > 0 && h('div', {
                                        className: "h-full bg-purple-500",
                                        style: { width: (weeklyProgress.restDays / 7 * 100) + '%' }
                                    })
                                ),
                                h('div', { className: "flex justify-between mt-1" },
                                    h('span', { className: "text-[8px] text-blue-600" }, "Training"),
                                    h('span', { className: "text-[8px] text-purple-600" }, "Rest")
                                )
                            )
                        ),
                        // All-time Stats
                        h('div', { className: "grid grid-cols-2 gap-3" },
                            h('div', { className: "bg-white p-3.5 rounded-2xl border shadow-sm text-center" },
                                h('p', { className: "text-[9px] font-bold text-slate-400 uppercase" }, "All-time Sessions"),
                                h('p', { className: "text-lg font-black text-blue-900" }, logs.length)
                            ),
                            h('div', { className: "bg-white p-3.5 rounded-2xl border shadow-sm text-center" },
                                h('p', { className: "text-[9px] font-bold text-slate-400 uppercase" }, "Avg Mins/Session"),
                                h('p', { className: "text-lg font-black text-blue-900" },
                                    logs.length ? Math.round(logs.reduce(function(a, c) { return a + c.duration; }, 0) / logs.length) : 0
                                )
                            )
                        )
                    );
                }

                // New Goals Tab - Weekly Goal History
                function renderGoals() {
                    // Calculate overall stats
                    var allPastWeeks = weeklyHistory.filter(function(w) { return !w.isCurrent; });
                    var totalGoalsMet = allPastWeeks.filter(function(w) { return w.goalMet; }).length;
                    var totalWeeks = allPastWeeks.length;
                    var successRate = totalWeeks > 0 ? Math.round((totalGoalsMet / totalWeeks) * 100) : 0;

                    return h('div', { className: "space-y-5 animate-in" },
                        // Header Stats
                        h('div', { className: "bg-white p-5 rounded-2xl border shadow-sm" },
                            h('h3', { className: "text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4 text-center" }, "Goal Achievement"),
                            h('div', { className: "grid grid-cols-3 gap-3" },
                                h('div', { className: "text-center" },
                                    h('div', { className: "w-10 h-10 mx-auto rounded-full bg-emerald-100 flex items-center justify-center mb-1" },
                                        h(Icon, { name: "Check", className: "w-5 h-5 text-emerald-600" })
                                    ),
                                    h('p', { className: "text-lg font-black text-emerald-600" }, totalGoalsMet),
                                    h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Goals Met")
                                ),
                                h('div', { className: "text-center" },
                                    h('div', { className: "w-10 h-10 mx-auto rounded-full bg-rose-100 flex items-center justify-center mb-1" },
                                        h(Icon, { name: "X", className: "w-5 h-5 text-rose-500" })
                                    ),
                                    h('p', { className: "text-lg font-black text-rose-500" }, totalWeeks - totalGoalsMet),
                                    h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Missed")
                                ),
                                h('div', { className: "text-center" },
                                    h('div', { className: "w-10 h-10 mx-auto rounded-full bg-blue-100 flex items-center justify-center mb-1" },
                                        h(Icon, { name: "Target", className: "w-5 h-5 text-blue-600" })
                                    ),
                                    h('p', { className: "text-lg font-black text-blue-600" }, successRate + "%"),
                                    h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Success")
                                )
                            )
                        ),
                        // Weekly Goal Info
                        h('div', { className: "bg-blue-900 p-4 rounded-2xl text-white" },
                            h('div', { className: "flex items-center justify-between" },
                                h('div', null,
                                    h('p', { className: "text-[9px] font-bold opacity-70 uppercase" }, "Current Weekly Goal"),
                                    h('p', { className: "text-xl font-extrabold" }, profile.weeklyGoal + " minutes")
                                ),
                                h('div', { className: "bg-white/20 p-3 rounded-xl" },
                                    h(Icon, { name: "Target", className: "w-6 h-6" })
                                )
                            )
                        ),
                        // Monthly History
                        h('div', { className: "flex flex-col" },
                            h('h3', { className: "text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1 mb-3" }, "Weekly Goal History"),
                            h('div', { className: "space-y-3 overflow-y-auto max-h-52", style: { WebkitOverflowScrolling: 'touch' } },
                                weeksByMonth.length > 0
                                    ? weeksByMonth.map(function(monthData) {
                                        return renderMonthGroup(monthData);
                                    })
                                    : h('p', { className: "text-center py-4 text-slate-300 text-xs italic" }, "No weekly history yet")
                            )
                        )
                    );
                }

                // Recovery Tab - Rest analysis and injury prevention
                function renderRecovery() {
                    var today = new Date();
                    var currentWeek = getWeekIdentifier(today);
                    var currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');

                    // All recovery/rest logs
                    var allRestLogs = logs.filter(function(l) { return l.type === 'rest' || l.type === 'recovery'; });
                    var allRecoveryLogs = logs.filter(function(l) { return l.type === 'recovery'; });

                    // This week's rest
                    var weekRestLogs = logs.filter(function(l) {
                        return (l.type === 'rest' || l.type === 'recovery') && getWeekIdentifier(l.date) === currentWeek;
                    });

                    // This month's rest
                    var monthRestLogs = logs.filter(function(l) {
                        var logMonth = l.date.substring(0, 7);
                        return (l.type === 'rest' || l.type === 'recovery') && logMonth === currentMonth;
                    });

                    // Last 30 days analysis
                    var last30Days = logs.filter(function(l) {
                        return (today - new Date(l.date)) / (1000 * 3600 * 24) <= 30;
                    });
                    var last30RestDays = last30Days.filter(function(l) { return l.type === 'rest' || l.type === 'recovery'; });
                    var last30HighIntensity = last30Days.filter(function(l) { return l.intensity === 'high'; });
                    var last30Training = last30Days.filter(function(l) { return l.type !== 'rest' && l.type !== 'recovery'; });

                    // Calculate recovery ratio
                    var totalActiveDays = last30Training.length;
                    var totalRestDays = last30RestDays.length;
                    var recoveryRatio = totalActiveDays > 0 ? (totalRestDays / totalActiveDays * 100).toFixed(0) : 0;

                    // Consecutive training days (injury risk)
                    var consecutiveTraining = 0;
                    var maxConsecutive = 0;
                    var sortedLogs = logs.slice().sort(function(a, b) { return new Date(b.date) - new Date(a.date); });
                    for (var i = 0; i < Math.min(sortedLogs.length, 14); i++) {
                        if (sortedLogs[i].type !== 'rest' && sortedLogs[i].type !== 'recovery') {
                            consecutiveTraining++;
                            maxConsecutive = Math.max(maxConsecutive, consecutiveTraining);
                        } else {
                            consecutiveTraining = 0;
                        }
                    }

                    // Generate suggestions based on patterns
                    var suggestions = [];
                    if (last30HighIntensity.length >= 10 && totalRestDays < 4) {
                        suggestions.push({ type: 'warning', icon: 'AlertTriangle', text: 'High training load detected. Consider adding more rest days to prevent overtraining.' });
                    }
                    if (consecutiveTraining >= 5) {
                        suggestions.push({ type: 'danger', icon: 'AlertCircle', text: 'You have trained ' + consecutiveTraining + ' days in a row. Take a rest day to reduce injury risk.' });
                    }
                    if (totalRestDays === 0 && last30Training.length > 0) {
                        suggestions.push({ type: 'warning', icon: 'AlertTriangle', text: 'No rest days logged this month. Rest is essential for muscle recovery.' });
                    }
                    if (recoveryRatio < 15 && totalActiveDays > 5) {
                        suggestions.push({ type: 'info', icon: 'Info', text: 'Aim for 1 rest day per 5-6 training days for optimal recovery.' });
                    }
                    if (allRecoveryLogs.length === 0 && last30Training.length > 10) {
                        suggestions.push({ type: 'info', icon: 'Lightbulb', text: 'Try adding active recovery sessions (stretching, yoga) to improve flexibility.' });
                    }
                    if (suggestions.length === 0 && totalRestDays >= 1) {
                        suggestions.push({ type: 'success', icon: 'CheckCircle', text: 'Great job! Your recovery schedule looks balanced.' });
                    }
                    if (suggestions.length === 0) {
                        suggestions.push({ type: 'info', icon: 'Info', text: 'Start logging rest days to get personalized recovery insights.' });
                    }

                    // Recovery type breakdown
                    var restTypeCount = allRestLogs.filter(function(l) { return l.type === 'rest'; }).length;
                    var recoveryTypeCount = allRecoveryLogs.length;

                    return h('div', { className: "space-y-3 animate-in" },
                        // Recovery Score Card - Compact
                        h('div', { className: "bg-gradient-to-br from-purple-600 to-indigo-700 p-3 rounded-xl text-white shadow-lg" },
                            h('div', { className: "flex items-center justify-between" },
                                h('div', null,
                                    h('p', { className: "text-[8px] font-bold opacity-70 uppercase tracking-widest" }, "Recovery Status"),
                                    h('p', { className: "text-lg font-extrabold" },
                                        consecutiveTraining >= 5 ? "Rest Needed" :
                                        totalRestDays >= 4 ? "Well Rested" :
                                        totalRestDays >= 1 ? "Moderate" : "Low Recovery"
                                    ),
                                    h('p', { className: "text-[9px] opacity-80" }, recoveryRatio + "% rest-to-training ratio")
                                ),
                                h('div', { className: "bg-white/20 p-2.5 rounded-lg" },
                                    h(Icon, { name: "Moon", className: "w-6 h-6" })
                                )
                            )
                        ),

                        // This Week & Month Stats - Compact
                        h('div', { className: "grid grid-cols-2 gap-2" },
                            h('div', { className: "bg-white p-3 rounded-xl border shadow-sm text-center" },
                                h('div', { className: "w-8 h-8 mx-auto rounded-full bg-purple-100 flex items-center justify-center mb-1" },
                                    h(Icon, { name: "Calendar", className: "w-4 h-4 text-purple-600" })
                                ),
                                h('p', { className: "text-xl font-black text-purple-600" }, weekRestLogs.length),
                                h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Rest This Week")
                            ),
                            h('div', { className: "bg-white p-3 rounded-xl border shadow-sm text-center" },
                                h('div', { className: "w-8 h-8 mx-auto rounded-full bg-indigo-100 flex items-center justify-center mb-1" },
                                    h(Icon, { name: "CalendarDays", className: "w-4 h-4 text-indigo-600" })
                                ),
                                h('p', { className: "text-xl font-black text-indigo-600" }, monthRestLogs.length),
                                h('p', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Rest This Month")
                            )
                        ),

                        // Recovery Type Breakdown - Compact
                        h('div', { className: "bg-white p-3 rounded-xl border shadow-sm" },
                            h('h4', { className: "text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-2" }, "Recovery Breakdown (All Time)"),
                            h('div', { className: "grid grid-cols-2 gap-2" },
                                h('div', { className: "flex items-center gap-2 p-2 bg-slate-50 rounded-lg" },
                                    h('span', { className: "text-base" }, "ðŸ˜´"),
                                    h('div', null,
                                        h('p', { className: "text-sm font-black text-slate-700" }, restTypeCount),
                                        h('p', { className: "text-[8px] text-slate-400" }, "Full Rest Days")
                                    )
                                ),
                                h('div', { className: "flex items-center gap-2 p-2 bg-slate-50 rounded-lg" },
                                    h('span', { className: "text-base" }, "ðŸ§˜"),
                                    h('div', null,
                                        h('p', { className: "text-sm font-black text-slate-700" }, recoveryTypeCount),
                                        h('p', { className: "text-[8px] text-slate-400" }, "Active Recovery")
                                    )
                                )
                            ),
                            // Total rest time from recovery sessions
                            allRecoveryLogs.length > 0 && h('div', { className: "mt-2 pt-2 border-t border-slate-100 flex items-center justify-between" },
                                h('span', { className: "text-[8px] font-bold text-slate-400 uppercase" }, "Total Recovery Time"),
                                h('span', { className: "text-xs font-black text-purple-600" },
                                    allRecoveryLogs.reduce(function(a, c) { return a + c.duration; }, 0) + " mins"
                                )
                            )
                        ),

                        // Training Load (Last 30 Days) - Compact
                        h('div', { className: "bg-white p-3 rounded-xl border shadow-sm" },
                            h('h4', { className: "text-[9px] font-bold text-slate-400 uppercase tracking-widest mb-2" }, "Last 30 Days Load"),
                            h('div', { className: "grid grid-cols-3 gap-1.5" },
                                h('div', { className: "text-center p-1.5 bg-blue-50 rounded-lg" },
                                    h('p', { className: "text-sm font-black text-blue-600" }, last30Training.length),
                                    h('p', { className: "text-[7px] font-bold text-slate-400 uppercase" }, "Training")
                                ),
                                h('div', { className: "text-center p-1.5 bg-orange-50 rounded-lg" },
                                    h('p', { className: "text-sm font-black text-orange-600" }, last30HighIntensity.length),
                                    h('p', { className: "text-[7px] font-bold text-slate-400 uppercase" }, "High Int.")
                                ),
                                h('div', { className: "text-center p-1.5 bg-purple-50 rounded-lg" },
                                    h('p', { className: "text-sm font-black text-purple-600" }, totalRestDays),
                                    h('p', { className: "text-[7px] font-bold text-slate-400 uppercase" }, "Rest")
                                )
                            ),
                            // Consecutive training warning
                            consecutiveTraining > 0 && h('div', { className: "mt-2 pt-2 border-t border-slate-100" },
                                h('div', { className: "flex items-center gap-2" },
                                    h(Icon, { name: consecutiveTraining >= 5 ? "AlertTriangle" : "Activity", className: "w-3.5 h-3.5 " + (consecutiveTraining >= 5 ? 'text-rose-500' : 'text-slate-400') }),
                                    h('span', { className: "text-[9px] " + (consecutiveTraining >= 5 ? 'text-rose-500 font-bold' : 'text-slate-500') },
                                        consecutiveTraining + " consecutive training day" + (consecutiveTraining > 1 ? 's' : '')
                                    )
                                )
                            )
                        ),

                        // Suggestions & Tips - Compact
                        h('div', { className: "space-y-1.5" },
                            h('h4', { className: "text-[9px] font-bold text-slate-400 uppercase tracking-widest px-1" }, "Recovery Insights"),
                            suggestions.map(function(s, i) {
                                var bgColor = s.type === 'danger' ? 'bg-rose-50' : s.type === 'warning' ? 'bg-amber-50' : s.type === 'success' ? 'bg-emerald-50' : 'bg-blue-50';
                                var textColor = s.type === 'danger' ? 'text-rose-600' : s.type === 'warning' ? 'text-amber-600' : s.type === 'success' ? 'text-emerald-600' : 'text-blue-600';
                                return h('div', { key: i, className: "flex items-start gap-2 p-2 rounded-lg " + bgColor },
                                    h(Icon, { name: s.icon, className: "w-3.5 h-3.5 mt-0.5 flex-shrink-0 " + textColor }),
                                    h('p', { className: "text-[10px] " + textColor }, s.text)
                                );
                            })
                        )
                    );
                }

                function renderProfile() {
                    return h('div', { className: "space-y-5 animate-in pb-20" },
                        h('section', { className: "space-y-3" },
                            h('h2', { className: "text-sm font-black px-1 uppercase tracking-wider text-slate-500" }, "Athlete Profile"),
                            h('div', { className: "bg-white p-5 rounded-2xl border space-y-4 shadow-sm" },
                                h('div', { className: "space-y-1" },
                                    h('label', { className: "text-[9px] font-bold text-slate-400 uppercase ml-1" }, "Full Name"),
                                    h('input', {
                                        className: "w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100 focus:ring-blue-900",
                                        value: profile.name,
                                        onChange: function(e) { setProfile(Object.assign({}, profile, { name: e.target.value })); }
                                    })
                                ),
                                h('div', { className: "grid grid-cols-2 gap-3" },
                                    h('div', { className: "space-y-1" },
                                        h('label', { className: "text-[9px] font-bold text-slate-400 uppercase ml-1" }, "Position"),
                                        h('select', {
                                            className: "w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100",
                                            value: profile.position,
                                            onChange: function(e) { setProfile(Object.assign({}, profile, { position: e.target.value })); }
                                        },
                                            ['Forward', 'Midfielder', 'Defender', 'Goalkeeper', 'Utility'].map(function(p) {
                                                return h('option', { key: p, value: p }, p);
                                            })
                                        )
                                    ),
                                    h('div', { className: "space-y-1" },
                                        h('label', { className: "text-[9px] font-bold text-slate-400 uppercase ml-1" }, "Jersey #"),
                                        h('input', {
                                            className: "w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100",
                                            value: profile.jerseyNumber,
                                            onChange: function(e) { setProfile(Object.assign({}, profile, { jerseyNumber: e.target.value })); }
                                        })
                                    )
                                ),
                                h('div', { className: "space-y-2 pt-1" },
                                    h('div', { className: "flex justify-between items-center px-1" },
                                        h('label', { className: "text-[9px] font-bold text-slate-400 uppercase" }, "Weekly Goal"),
                                        h('span', { className: "text-xs font-black text-blue-900" }, profile.weeklyGoal + "m")
                                    ),
                                    h('input', {
                                        type: "range", min: "60", max: "600", step: "30",
                                        value: profile.weeklyGoal,
                                        onChange: function(e) { setProfile(Object.assign({}, profile, { weeklyGoal: parseInt(e.target.value) })); },
                                        className: "w-full"
                                    })
                                )
                            )
                        ),
                        h('section', { className: "space-y-3" },
                            h('h2', { className: "text-sm font-black px-1 uppercase tracking-wider text-slate-500" }, "Display"),
                            h('div', { className: "bg-white p-4 rounded-2xl border shadow-sm" },
                                h('div', { className: "space-y-2" },
                                    h('div', { className: "flex justify-between items-center" },
                                        h('label', { className: "text-[9px] font-bold text-slate-400 uppercase" }, "Font Size"),
                                        h('span', { className: "text-xs font-black text-blue-900" },
                                            (FONT_SIZES.find(function(f) { return f.id === fontSize; }) || FONT_SIZES[1]).name
                                        )
                                    ),
                                    h('div', { className: "grid grid-cols-4 gap-2" },
                                        FONT_SIZES.map(function(size) {
                                            return h('button', {
                                                key: size.id,
                                                onClick: function() { setFontSize(size.id); },
                                                className: "p-2 rounded-xl text-center transition-all " +
                                                    (fontSize === size.id
                                                        ? 'bg-blue-900 text-white'
                                                        : 'bg-slate-50 text-slate-600 hover:bg-slate-100')
                                            },
                                                h('span', { className: "text-[10px] font-bold", style: { fontSize: (10 * size.scale) + 'px' } }, "Aa"),
                                                h('p', { className: "text-[8px] mt-0.5 opacity-70" }, size.name)
                                            );
                                        })
                                    )
                                )
                            )
                        ),
                        h('section', { className: "space-y-3" },
                            h('h2', { className: "text-sm font-black px-1 uppercase tracking-wider text-slate-500" }, "App Settings"),
                            h('div', { className: "bg-white p-3 rounded-2xl border space-y-1 shadow-sm" },
                                !isStandalone && h('button', {
                                    onClick: handleInstallClick,
                                    className: "w-full flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors text-blue-900"
                                },
                                    h('div', { className: "w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center" }, h(Icon, { name: "Smartphone" })),
                                    h('div', { className: "text-left flex-1" },
                                        h('p', { className: "font-bold text-xs" }, "Install App"),
                                        h('p', { className: "text-[9px] text-slate-400" }, "Full-screen home screen access")
                                    ),
                                    h(Icon, { name: "Plus", className: "w-3 h-3" })
                                ),
                                h('button', {
                                    onClick: exportData,
                                    className: "w-full flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors"
                                },
                                    h('div', { className: "w-8 h-8 rounded-lg bg-slate-50 text-slate-600 flex items-center justify-center" }, h(Icon, { name: "Download" })),
                                    h('div', { className: "text-left flex-1" },
                                        h('p', { className: "font-bold text-xs" }, "Export Backup"),
                                        h('p', { className: "text-[9px] text-slate-400" }, "Download .json data")
                                    ),
                                    h(Icon, { name: "ChevronRight", className: "text-slate-300 w-3 h-3" })
                                ),
                                h('button', {
                                    onClick: function() { fileInputRef.current.click(); },
                                    className: "w-full flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors"
                                },
                                    h('div', { className: "w-8 h-8 rounded-lg bg-emerald-50 text-emerald-900 flex items-center justify-center" }, h(Icon, { name: "Upload" })),
                                    h('div', { className: "text-left flex-1" },
                                        h('p', { className: "font-bold text-xs" }, "Restore Backup"),
                                        h('p', { className: "text-[9px] text-slate-400" }, "Upload .json data")
                                    ),
                                    h(Icon, { name: "ChevronRight", className: "text-slate-300 w-3 h-3" })
                                ),
                                h('input', {
                                    type: "file", ref: fileInputRef, onChange: importData, accept: ".json", className: "hidden"
                                }),
                                h('button', {
                                    onClick: function() { setShowBugReport(true); },
                                    className: "w-full flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors"
                                },
                                    h('div', { className: "w-8 h-8 rounded-lg bg-amber-50 text-amber-600 flex items-center justify-center" }, h(Icon, { name: "Bug" })),
                                    h('div', { className: "text-left flex-1" },
                                        h('p', { className: "font-bold text-xs" }, "Report Bug"),
                                        h('p', { className: "text-[9px] text-slate-400" }, "Help us improve the app")
                                    ),
                                    h(Icon, { name: "ChevronRight", className: "text-slate-300 w-3 h-3" })
                                ),
                                h('div', { className: "pt-2 px-1" },
                                    h('button', {
                                        onClick: resetAllData,
                                        className: "w-full p-2.5 text-rose-500 rounded-xl font-bold text-[10px] uppercase hover:bg-rose-50 transition-colors border border-rose-100"
                                    }, "Wipe Local Storage")
                                )
                            )
                        ),
                        h('p', { className: "text-center text-[9px] font-bold text-slate-300 uppercase pb-6" }, "Version 2.3.2-PWA")
                    );
                }

                function renderAddModal() {
                    if (!showAddModal) return null;
                    return h('div', { className: "fixed inset-0 bg-slate-900/40 backdrop-blur-[2px] z-[100] flex items-end sm:items-center justify-center p-4" },
                        h('div', { className: "bg-white w-full max-sm:rounded-t-3xl sm:rounded-3xl p-6 space-y-4 animate-in" },
                            h('div', { className: "flex justify-between items-center" },
                                h('h2', { className: "text-sm font-black uppercase tracking-widest text-slate-500" }, "Log Activity"),
                                h('button', { onClick: function() { setShowAddModal(false); }, className: "p-1 text-slate-300" }, h(Icon, { name: "X" }))
                            ),
                            h('div', { className: "grid grid-cols-3 gap-2" },
                                EXERCISE_TYPES.map(function(t) {
                                    return h('button', {
                                        key: t.id,
                                        onClick: function() { setNewLog(Object.assign({}, newLog, { type: t.id })); },
                                        className: "p-2 rounded-xl border flex flex-col items-center gap-1 transition-all " +
                                            (newLog.type === t.id ? 'border-blue-900 bg-blue-50 text-blue-900' : 'border-slate-100 bg-slate-50 text-slate-400')
                                    },
                                        h('span', { className: "text-base" }, t.icon),
                                        h('span', { className: "text-[9px] font-bold uppercase" }, t.name)
                                    );
                                })
                            ),
                            h('div', { className: "space-y-3" },
                                h('div', { className: "space-y-1" },
                                    h('label', { className: "text-[9px] font-bold text-slate-400 uppercase ml-1" }, "Date"),
                                    h('input', {
                                        type: "date",
                                        className: "w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100",
                                        value: newLog.date,
                                        onChange: function(e) { setNewLog(Object.assign({}, newLog, { date: e.target.value })); }
                                    })
                                ),
                                newLog.type !== 'rest' && h('div', { className: "grid grid-cols-2 gap-3" },
                                    h('div', { className: "space-y-1" },
                                        h('label', { className: "text-[9px] font-bold text-slate-400 uppercase ml-1" }, "Duration (Mins)"),
                                        h('input', {
                                            type: "number",
                                            className: "w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100",
                                            placeholder: "0",
                                            value: newLog.duration,
                                            onChange: function(e) { setNewLog(Object.assign({}, newLog, { duration: e.target.value })); }
                                        })
                                    ),
                                    h('div', { className: "space-y-1" },
                                        h('label', { className: "text-[9px] font-bold text-slate-400 uppercase ml-1" }, "Intensity"),
                                        h('select', {
                                            className: "w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100",
                                            value: newLog.intensity,
                                            onChange: function(e) { setNewLog(Object.assign({}, newLog, { intensity: e.target.value })); }
                                        },
                                            INTENSITY_LEVELS.map(function(i) {
                                                return h('option', { key: i.id, value: i.id }, i.name);
                                            })
                                        )
                                    )
                                )
                            ),
                            h('button', {
                                onClick: addLog,
                                className: "w-full bg-blue-900 text-white p-3.5 rounded-xl font-black shadow-lg uppercase text-[11px] tracking-widest mt-2 active:scale-95 transition-transform"
                            }, "Save Activity")
                        )
                    );
                }

                return h('div', { className: "min-h-screen h-full bg-slate-50 flex flex-col max-w-md mx-auto relative font-scale-" + fontSize },
                    h('header', { className: "bg-white border-b px-4 py-3 sticky top-0 z-50 flex items-center justify-between flex-shrink-0" },
                        h('div', { className: "flex items-center gap-2" },
                            h('img', { src: LOGO_URL, className: "w-6 h-6 object-contain" }),
                            h('h1', { className: "font-extrabold text-blue-900 text-sm tracking-tight" }, "STC HOCKEY")
                        ),
                        statusMsg && h('span', { className: "text-[9px] font-bold uppercase text-blue-600 animate-pulse text-right max-w-[150px] leading-tight" }, statusMsg)
                    ),
                    showInstallBanner && h('div', { className: "m-4 bg-blue-900 text-white p-4 rounded-2xl flex items-center justify-between shadow-lg animate-in flex-shrink-0" },
                        h('div', { className: "flex items-center gap-3" },
                            h('div', { className: "bg-white/20 p-2 rounded-xl" }, h(Icon, { name: "Smartphone" })),
                            h('div', null,
                                h('p', { className: "font-bold text-xs" }, "Install App"),
                                h('p', { className: "text-[10px] opacity-80" }, "Full-screen access from home screen")
                            )
                        ),
                        h('div', { className: "flex gap-2" },
                            h('button', { onClick: function() { setShowInstallBanner(false); }, className: "px-3 py-1.5 text-[10px] font-bold uppercase" }, "Later"),
                            h('button', { onClick: handleInstallClick, className: "bg-white text-blue-900 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase" }, "Install")
                        )
                    ),
                    h('main', { className: "main-content flex-1 p-4 space-y-5 pb-36" },
                        activeTab === 'dashboard' && renderDashboard(),
                        activeTab === 'history' && renderHistory(),
                        activeTab === 'analysis' && renderAnalysis(),
                        activeTab === 'goals' && renderGoals(),
                        activeTab === 'recovery' && renderRecovery(),
                        activeTab === 'profile' && renderProfile()
                    ),
                    h('nav', {
                        className: "fixed bottom-5 left-4 right-4 max-w-md mx-auto bg-white/95 backdrop-blur-sm border rounded-2xl px-2 py-1.5 flex items-center shadow-lg z-[60]",
                        style: { marginBottom: 'env(safe-area-inset-bottom)' }
                    },
                        // Left side - 3 buttons
                        h('div', { className: "flex-1 flex justify-evenly" },
                            h(NavBtn, { active: activeTab === 'dashboard', onClick: function() { setActiveTab('dashboard'); }, icon: "Home" }),
                            h(NavBtn, { active: activeTab === 'history', onClick: function() { setActiveTab('history'); }, icon: "Calendar" }),
                            h(NavBtn, { active: activeTab === 'analysis', onClick: function() { setActiveTab('analysis'); }, icon: "PieChart" })
                        ),
                        // Center - Add button
                        h('button', {
                            onClick: function() { setShowAddModal(true); },
                            className: "bg-blue-900 text-white w-11 h-11 rounded-xl flex items-center justify-center shadow-md active:scale-90 transition-all mx-2 flex-shrink-0"
                        }, h(Icon, { name: "Plus", className: "w-5 h-5" })),
                        // Right side - 3 buttons
                        h('div', { className: "flex-1 flex justify-evenly" },
                            h(NavBtn, { active: activeTab === 'goals', onClick: function() { setActiveTab('goals'); }, icon: "Target" }),
                            h(NavBtn, { active: activeTab === 'recovery', onClick: function() { setActiveTab('recovery'); }, icon: "Heart" }),
                            h(NavBtn, { active: activeTab === 'profile', onClick: function() { setActiveTab('profile'); }, icon: "Settings" })
                        )
                    ),
                    renderAddModal(),
                    confirmDialog && h(ConfirmDialog, {
                        message: confirmDialog.message,
                        onConfirm: confirmDialog.onConfirm,
                        onCancel: confirmDialog.onCancel
                    }),
                    showBugReport && h('div', { className: "fixed inset-0 bg-slate-900/40 backdrop-blur-[2px] z-[200] flex items-center justify-center p-4" },
                        h('div', { className: "bg-white w-full max-w-sm rounded-2xl p-5 space-y-4 animate-in shadow-xl" },
                            h('div', { className: "flex items-center justify-between" },
                                h('div', { className: "flex items-center gap-3" },
                                    h('div', { className: "w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center" },
                                        h(Icon, { name: "Bug", className: "w-5 h-5 text-amber-600" })
                                    ),
                                    h('h3', { className: "text-sm font-bold text-slate-800" }, "Report a Bug")
                                ),
                                h('button', { onClick: function() { setShowBugReport(false); }, className: "p-1 text-slate-300 hover:text-slate-500" },
                                    h(Icon, { name: "X", className: "w-5 h-5" })
                                )
                            ),
                            h('p', { className: "text-xs text-slate-500" }, "Help us improve the app by reporting any issues you encounter."),
                            h('div', { className: "space-y-3" },
                                h('div', { className: "flex items-start gap-3 p-3 bg-slate-50 rounded-xl" },
                                    h('div', { className: "w-6 h-6 rounded-full bg-blue-900 text-white flex items-center justify-center flex-shrink-0 text-xs font-bold" }, "1"),
                                    h('div', null,
                                        h('p', { className: "text-xs font-bold text-slate-700" }, "Screenshot the issue"),
                                        h('p', { className: "text-[10px] text-slate-400" }, "Capture what went wrong")
                                    )
                                ),
                                h('div', { className: "flex items-start gap-3 p-3 bg-slate-50 rounded-xl" },
                                    h('div', { className: "w-6 h-6 rounded-full bg-blue-900 text-white flex items-center justify-center flex-shrink-0 text-xs font-bold" }, "2"),
                                    h('div', null,
                                        h('p', { className: "text-xs font-bold text-slate-700" }, "Describe the issue"),
                                        h('p', { className: "text-[10px] text-slate-400" }, "Explain what happened and what you expected")
                                    )
                                ),
                                h('div', { className: "flex items-start gap-3 p-3 bg-slate-50 rounded-xl" },
                                    h('div', { className: "w-6 h-6 rounded-full bg-blue-900 text-white flex items-center justify-center flex-shrink-0 text-xs font-bold" }, "3"),
                                    h('div', null,
                                        h('p', { className: "text-xs font-bold text-slate-700" }, "Send an email with the details"),
                                        h('p', { className: "text-[10px] text-slate-400" }, "Include screenshot and description")
                                    )
                                )
                            ),
                            h('div', { className: "bg-blue-50 p-3 rounded-xl" },
                                h('p', { className: "text-[10px] font-bold text-blue-900 uppercase tracking-wider mb-1" }, "Email to:"),
                                h('a', {
                                    href: "mailto:alfie_yang@moe.edu.sg?subject=STC%20Hockey%20App%20Bug%20Report",
                                    className: "text-sm font-bold text-blue-600 underline"
                                }, "alfie_yang@moe.edu.sg")
                            ),
                            h('p', { className: "text-center text-[10px] text-slate-400" }, "Thank you for helping us improve!"),
                            h('button', {
                                onClick: function() { setShowBugReport(false); },
                                className: "w-full p-3 rounded-xl font-bold text-xs uppercase text-white bg-blue-900 hover:bg-blue-800 transition-colors"
                            }, "Got it")
                        )
                    ),
                    showSplash && h('div', {
                        className: "fixed inset-0 z-[300] flex flex-col items-center justify-center bg-slate-50",
                        style: { animation: showSplash ? 'none' : 'fadeOut 0.3s ease-out forwards' }
                    },
                        h('img', {
                            src: LOGO_URL,
                            className: "w-32 h-auto object-contain mb-4",
                            alt: "CHIJ STC Logo"
                        }),
                        h('h1', { className: "text-xl font-extrabold text-blue-900 tracking-tight text-center" }, "CHIJ STC HOCKEY"),
                        h('p', { className: "text-xs text-slate-500 mt-2 italic" }, "Train smart. Rest well. Play better."),
                        h('p', { className: "text-[10px] text-slate-400 mt-4 uppercase tracking-widest" }, "Loading...")
                    )
                );
            }

            var root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(h(App));
        })();
    </script>
</body>
</html>
