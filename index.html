<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STC Hockey Tracker</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for browser compilation -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        
        // Inline Lucide Icon components for simple usage in single file
        const Icon = ({ name, className }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                const icon = lucide.icons[name];
                if (icon) {
                    const svgString = icon.map(tag => {
                        const [tagName, attrs] = tag;
                        const attrString = Object.entries(attrs).map(([k, v]) => `${k}="${v}"`).join(' ');
                        return `<${tagName} ${attrString}></${tagName}>`;
                    }).join('');
                    setSvg(svgString);
                }
            }, [name]);
            return <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" 
                height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
                dangerouslySetInnerHTML={{ __html: svg }}
            />;
        };

        // --- CONFIGURATION ---
        const LOGO_URL = "https://www.chijourladyofgoodcounsel.moe.edu.sg/images/CHIJOLGC%20Crest.png"; 
        const STORAGE_KEY_LOGS = "stc_hockey_logs_v1";
        const STORAGE_KEY_PROFILE = "stc_hockey_profile_v1";
        const HOCKEY_POSITIONS = ["Forward", "Midfielder", "Defender", "Goalkeeper", "Utility"];

        const EXERCISE_TYPES = [
            { id: 'match', name: 'Hockey Match', icon: 'ðŸ‘', calPerMin: 12 },
            { id: 'drills', name: 'Skills & Drills', icon: 'ðŸŽ¯', calPerMin: 8 },
            { id: 'fitness', name: 'Fitness / Sprints', icon: 'ðŸƒ', calPerMin: 11 },
            { id: 'endurance', name: 'Endurance Training', icon: 'ðŸ‘Ÿ', calPerMin: 9 },
            { id: 'strength', name: 'Strength Training', icon: 'ðŸ’ª', calPerMin: 6 },
            { id: 'recovery', name: 'Active Recovery', icon: 'ðŸ§˜', calPerMin: 3 },
            { id: 'rest', name: 'Full Rest Day', icon: 'ðŸ˜´', calPerMin: 0 },
            { id: 'other', name: 'Other Sports', icon: 'ðŸ€', calPerMin: 7 },
        ];

        const INTENSITY_LEVELS = [
            { id: 'none', name: 'N/A', multiplier: 0, color: 'text-slate-400', bg: 'bg-slate-50' },
            { id: 'low', name: 'Low', multiplier: 0.7, color: 'text-emerald-500', bg: 'bg-emerald-50' },
            { id: 'moderate', name: 'Moderate', multiplier: 1.0, color: 'text-amber-500', bg: 'bg-amber-50' },
            { id: 'high', name: 'High', multiplier: 1.4, color: 'text-rose-500', bg: 'bg-rose-50' },
        ];

        // --- APP ---
        function App() {
            const [logs, setLogs] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY_LOGS);
                return saved ? JSON.parse(saved) : [];
            });
            const [profile, setProfile] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY_PROFILE);
                return saved ? JSON.parse(saved) : { name: 'STC Athlete', position: 'Midfielder', jerseyNumber: '07', weeklyGoal: 300, intensityGoal: 3 };
            });
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showAddModal, setShowAddModal] = useState(false);
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [statusMsg, setStatusMsg] = useState(null);
            const [newLog, setNewLog] = useState({ type: 'drills', duration: '', intensity: 'moderate', date: new Date().toISOString().split('T')[0] });

            useEffect(() => { localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs)); }, [logs]);
            
            const addLog = (e) => {
                e.preventDefault();
                const durationVal = newLog.type === 'rest' ? 0 : parseInt(newLog.duration || 0);
                if (newLog.type !== 'rest' && durationVal <= 0) {
                    setStatusMsg({ type: 'error', text: 'Minutes must be greater than 0' });
                    return;
                }
                const entry = { id: Date.now(), ...newLog, duration: durationVal };
                setLogs([entry, ...logs].sort((a, b) => new Date(b.date) - new Date(a.date)));
                setShowAddModal(false);
                setNewLog({ ...newLog, duration: '' });
                setStatusMsg({ type: 'success', text: 'Activity logged!' });
            };

            const deleteLog = (id) => {
                setLogs(logs.filter(l => l.id !== id));
                setStatusMsg({ type: 'info', text: 'Log deleted.' });
            };

            return (
                <div className="min-h-screen bg-slate-50 pb-24">
                    {/* Status Message */}
                    {statusMsg && (
                        <div className="fixed top-4 left-4 right-4 z-[100] p-4 rounded-2xl bg-white shadow-xl border flex items-center gap-3 animate-bounce">
                            <span className="text-xs font-black uppercase">{statusMsg.text}</span>
                        </div>
                    )}

                    <header className="bg-white border-b p-4 sticky top-0 z-50">
                        <div className="max-w-md mx-auto flex items-center gap-3">
                            <img src={LOGO_URL} className="w-8 h-8 object-contain" />
                            <h1 className="font-black text-blue-900 tracking-tighter">STC HOCKEY</h1>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto p-4">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6">
                                <div className="bg-blue-900 rounded-[32px] p-6 text-white shadow-xl">
                                    <p className="text-[10px] font-bold opacity-60 uppercase tracking-widest">Athlete Profile</p>
                                    <h2 className="text-2xl font-black mb-4">{profile.name}</h2>
                                    <div className="flex gap-2">
                                        <div className="bg-white/10 px-3 py-1 rounded-lg text-[10px] font-bold">{profile.position}</div>
                                        <div className="bg-white/10 px-3 py-1 rounded-lg text-[10px] font-bold">#{profile.jerseyNumber}</div>
                                    </div>
                                </div>

                                <div className="space-y-3">
                                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest">Recent Logs</h3>
                                    {logs.slice(0, 5).map(log => (
                                        <div key={log.id} className="bg-white p-4 rounded-2xl border flex justify-between items-center">
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl">{(EXERCISE_TYPES.find(t=>t.id===log.type)||{}).icon}</span>
                                                <div>
                                                    <p className="font-black text-sm">{(EXERCISE_TYPES.find(t=>t.id===log.type)||{}).name}</p>
                                                    <p className="text-[10px] text-slate-400 font-bold uppercase">{log.date} â€¢ {log.duration}m</p>
                                                </div>
                                            </div>
                                            <button onClick={()=>deleteLog(log.id)} className="text-slate-300 hover:text-rose-500"><Icon name="Trash2" className="w-4 h-4" /></button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'profile' && (
                            <div className="bg-white p-6 rounded-[32px] border space-y-4">
                                <h2 className="font-black text-xl">Settings</h2>
                                <input className="w-full p-3 bg-slate-50 rounded-xl font-bold" value={profile.name} onChange={e=>setProfile({...profile, name: e.target.value})} placeholder="Name" />
                                <select className="w-full p-3 bg-slate-50 rounded-xl font-bold" value={profile.position} onChange={e=>setProfile({...profile, position: e.target.value})}>
                                    {HOCKEY_POSITIONS.map(p => <option key={p} value={p}>{p}</option>)}
                                </select>
                                <button onClick={() => {localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profile)); setStatusMsg({type:'success', text:'Saved!'})}} className="w-full bg-blue-900 text-white p-4 rounded-xl font-black">Save Profile</button>
                            </div>
                        )}
                    </main>

                    {/* Bottom Nav */}
                    <nav className="fixed bottom-6 left-4 right-4 max-w-md mx-auto bg-white/90 backdrop-blur-md border rounded-[24px] p-2 flex justify-around items-center shadow-2xl">
                        <button onClick={()=>setActiveTab('dashboard')} className={`p-3 rounded-xl ${activeTab==='dashboard'?'bg-blue-900 text-white':'text-slate-400'}`}><Icon name="Activity" /></button>
                        <button onClick={()=>setShowAddModal(true)} className="bg-blue-900 text-white w-12 h-12 rounded-xl flex items-center justify-center shadow-lg"><Icon name="Plus" /></button>
                        <button onClick={()=>setActiveTab('profile')} className={`p-3 rounded-xl ${activeTab==='profile'?'bg-blue-900 text-white':'text-slate-400'}`}><Icon name="User" /></button>
                    </nav>

                    {/* Add Modal */}
                    {showAddModal && (
                        <div className="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-[32px] p-6 space-y-4">
                                <h3 className="font-black text-lg">Log Activity</h3>
                                <div className="grid grid-cols-2 gap-2">
                                    {EXERCISE_TYPES.map(t => (
                                        <button key={t.id} onClick={()=>setNewLog({...newLog, type:t.id})} className={`p-2 rounded-xl border text-[10px] font-black uppercase flex items-center gap-2 ${newLog.type===t.id?'border-blue-900 bg-blue-50 text-blue-900':'border-slate-100'}`}>
                                            <span>{t.icon}</span> {t.name}
                                        </button>
                                    ))}
                                </div>
                                <input type="date" className="w-full p-3 bg-slate-50 rounded-xl font-bold" value={newLog.date} onChange={e=>setNewLog({...newLog, date: e.target.value})} />
                                {newLog.type !== 'rest' && (
                                    <input type="number" min="1" className="w-full p-3 bg-slate-50 rounded-xl font-bold" placeholder="Minutes" value={newLog.duration} onChange={e=>setNewLog({...newLog, duration:e.target.value})} />
                                )}
                                <div className="flex gap-2">
                                    <button onClick={()=>setShowAddModal(false)} className="flex-1 font-bold text-slate-400">Cancel</button>
                                    <button onClick={addLog} className="flex-1 bg-blue-900 text-white p-3 rounded-xl font-black">Add</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // --- PWA Service Worker ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'stc-hockey-v1';
                    self.addEventListener('install', e => e.waitUntil(caches.open(CACHE_NAME)));
                    self.addEventListener('fetch', e => e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))));
                `;
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                navigator.serviceWorker.register(swUrl).catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>
</html>