<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STC Hockey Tracker</title>
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e3a8a">
    <link rel="apple-touch-icon" href="https://www.chijourladyofgoodcounsel.moe.edu.sg/images/CHIJOLGC%20Crest.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href='data:application/json,{"name":"STC Hockey Tracker","short_name":"STCHockey","start_url":".","display":"standalone","background_color":"#f8fafc","theme_color":"#1e3a8a","icons":[{"src":"https://www.chijourladyofgoodcounsel.moe.edu.sg/images/CHIJOLGC%20Crest.png","sizes":"192x192","type":"image/png"}]}'>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input[type="range"] { -webkit-appearance: none; background: transparent; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #1e3a8a; cursor: pointer; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        input[type="range"]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px; }
        .animate-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .nav-btn-active { @apply bg-blue-900 text-white shadow-md; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        /**
         * NOTE: In certain restricted environments (like iframes or specific sandbox origins), 
         * Service Workers and Blob-based SW registration might be blocked by the browser. 
         * We wrap this in a try-catch and check for secure context.
         */
        if ('serviceWorker' in navigator && window.isSecureContext) {
            try {
                // We use a Data URI instead of a Blob URL to avoid the protocol error in some sandboxes
                const swCode = `self.addEventListener('install', e => self.skipWaiting()); self.addEventListener('fetch', e => e.respondWith(fetch(e.request)));`;
                const swUrl = 'data:text/javascript;base64,' + btoa(swCode);
                
                // Note: Standard browser security typically requires Service Workers to be served from the same origin 
                // and via HTTPS. If this still fails in the preview sandbox, the app functions will remain intact.
                navigator.serviceWorker.register(swUrl).catch(err => {
                    console.warn("ServiceWorker registration skipped (Sandbox limitation):", err.message);
                });
            } catch (e) {
                console.warn("ServiceWorker setup failed:", e);
            }
        }

        // --- ICON COMPONENT ---
        const Icon = ({ name, className = "w-4 h-4" }) => {
            const [svg, setSvg] = useState('');
            useEffect(() => {
                const icon = lucide.icons[name];
                if (icon) {
                    const svgString = icon.map(tag => {
                        const [tagName, attrs] = tag;
                        const attrString = Object.entries(attrs).map(([k, v]) => `${k}="${v}"`).join(' ');
                        return `<${tagName} ${attrString}></${tagName}>`;
                    }).join('');
                    setSvg(svgString);
                }
            }, [name]);
            return <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className} dangerouslySetInnerHTML={{ __html: svg }} />;
        };

        // --- CONSTANTS ---
        const LOGO_URL = "https://www.chijourladyofgoodcounsel.moe.edu.sg/images/CHIJOLGC%20Crest.png";
        const STORAGE_KEY_LOGS = "stc_hockey_logs_vfinal";
        const STORAGE_KEY_PROFILE = "stc_hockey_profile_vfinal";
        
        const EXERCISE_TYPES = [
            { id: 'match', name: 'Match', icon: 'ðŸ‘' },
            { id: 'drills', name: 'Drills', icon: 'ðŸŽ¯' },
            { id: 'fitness', name: 'Fitness', icon: 'ðŸƒ' },
            { id: 'strength', name: 'Strength', icon: 'ðŸ’ª' },
            { id: 'recovery', name: 'Recovery', icon: 'ðŸ§˜' },
            { id: 'rest', name: 'Rest', icon: 'ðŸ˜´' }
        ];

        const INTENSITY_LEVELS = [
            { id: 'low', name: 'Low' },
            { id: 'moderate', name: 'Med' },
            { id: 'high', name: 'High' }
        ];

        const getWeekIdentifier = (date) => {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(d.setDate(diff)).toISOString().split('T')[0];
        };

        const LogItem = ({ log, onDelete }) => {
            const type = EXERCISE_TYPES.find(t => t.id === log.type) || {};
            return (
                <div className="bg-white p-3 rounded-xl border flex items-center justify-between animate-in">
                    <div className="flex items-center gap-3">
                        <span className="text-lg">{type.icon}</span>
                        <div>
                            <p className="font-bold text-xs">{type.name}</p>
                            <p className="text-[10px] font-medium text-slate-400">
                                {log.date} â€¢ {log.duration}m â€¢ {log.intensity}
                            </p>
                        </div>
                    </div>
                    <button onClick={() => onDelete(log.id)} className="text-slate-300 hover:text-rose-500 p-1">
                        <Icon name="Trash2" className="w-3.5 h-3.5" />
                    </button>
                </div>
            );
        };

        function App() {
            const [logs, setLogs] = useState(() => JSON.parse(localStorage.getItem(STORAGE_KEY_LOGS) || '[]'));
            const [profile, setProfile] = useState(() => JSON.parse(localStorage.getItem(STORAGE_KEY_PROFILE) || '{"name":"STC Athlete","position":"Midfielder","jerseyNumber":"07","weeklyGoal":300}'));
            const [activeTab, setActiveTab] = useState('dashboard');
            const [showAddModal, setShowAddModal] = useState(false);
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [viewDate, setViewDate] = useState(new Date());
            const [statusMsg, setStatusMsg] = useState(null);
            const [newLog, setNewLog] = useState({ type: 'drills', duration: '', intensity: 'moderate', date: new Date().toISOString().split('T')[0] });
            const fileInputRef = useRef(null);

            // PWA Install Logic
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [showInstallBanner, setShowInstallBanner] = useState(false);
            const [isIOS, setIsIOS] = useState(false);

            useEffect(() => {
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
                const iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
                setIsIOS(iOS);

                if (!isStandalone) {
                    const handler = (e) => {
                        e.preventDefault();
                        setDeferredPrompt(e);
                        setShowInstallBanner(true);
                    };
                    window.addEventListener('beforeinstallprompt', handler);
                    if (iOS) setShowInstallBanner(true);
                    return () => window.removeEventListener('beforeinstallprompt', handler);
                }
            }, []);

            const handleInstallClick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        setDeferredPrompt(null);
                        setShowInstallBanner(false);
                    }
                } else if (isIOS) {
                    notify("iOS: Tap 'Share' then 'Add to Home Screen'");
                } else {
                    notify("Use browser menu to 'Install' or 'Add to Home Screen'");
                }
            };

            useEffect(() => { localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs)); }, [logs]);
            useEffect(() => { localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profile)); }, [profile]);

            const notify = (msg) => {
                setStatusMsg(msg);
                setTimeout(() => setStatusMsg(null), 2500);
            };

            const addLog = (e) => {
                e.preventDefault();
                const durationVal = newLog.type === 'rest' ? 0 : parseInt(newLog.duration || 0);
                if (newLog.type !== 'rest' && durationVal <= 0) {
                    notify('Invalid duration');
                    return;
                }
                const entry = { id: Date.now(), ...newLog, duration: durationVal };
                setLogs([entry, ...logs].sort((a, b) => new Date(b.date) - new Date(a.date)));
                setShowAddModal(false);
                setNewLog({ ...newLog, duration: '' });
                notify('Logged!');
            };

            const deleteLog = (id) => {
                setLogs(logs.filter(l => l.id !== id));
                notify('Deleted');
            };

            const exportData = () => {
                const dataStr = JSON.stringify({ logs, profile }, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', `stc-hockey-data.json`);
                linkElement.click();
            };

            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const json = JSON.parse(e.target.result);
                        if (json.logs) setLogs(json.logs);
                        if (json.profile) setProfile(json.profile);
                        notify('Restored!');
                    } catch (err) { notify('Error reading file'); }
                };
                reader.readAsText(file);
            };

            const resetAllData = () => {
                if (window.confirm("Delete all history?")) {
                    setLogs([]);
                    notify('Reset');
                }
            };

            const recoveryInsight = useMemo(() => {
                const last7Days = logs.filter(l => (new Date() - new Date(l.date)) / (1000 * 3600 * 24) <= 7);
                const highIntensity = last7Days.filter(l => l.intensity === 'high').length;
                const restDays = last7Days.filter(l => l.type === 'rest').length;
                if (highIntensity >= 3 && restDays < 1) return { text: "Strain High: Rest recommended.", color: "text-rose-600 bg-rose-50", icon: "AlertCircle" };
                if (restDays >= 1) return { text: "Balanced: Recovery is optimal.", color: "text-emerald-600 bg-emerald-50", icon: "Check" };
                return { text: "Log rest days to track recovery.", color: "text-blue-600 bg-blue-50", icon: "Info" };
            }, [logs]);

            const weeklyProgress = useMemo(() => {
                const currentWeek = getWeekIdentifier(new Date());
                const mins = logs.filter(l => getWeekIdentifier(l.date) === currentWeek).reduce((a,c) => a + c.duration, 0);
                return { mins, percent: Math.min(100, (mins / profile.weeklyGoal) * 100) };
            }, [logs, profile.weeklyGoal]);

            return (
                <div className="min-h-screen bg-slate-50 flex flex-col max-w-md mx-auto relative overflow-x-hidden pb-24">
                    <header className="bg-white border-b px-4 py-3 sticky top-0 z-50 flex items-center justify-between">
                        <div className="flex items-center gap-2">
                            <img src={LOGO_URL} className="w-6 h-6 object-contain" />
                            <h1 className="font-extrabold text-blue-900 text-sm tracking-tight">STC HOCKEY</h1>
                        </div>
                        {statusMsg && <span className="text-[9px] font-bold uppercase text-blue-600 animate-pulse text-right max-w-[150px] leading-tight">{statusMsg}</span>}
                    </header>

                    {showInstallBanner && (
                        <div className="m-4 bg-blue-900 text-white p-4 rounded-2xl flex items-center justify-between shadow-lg animate-in">
                            <div className="flex items-center gap-3">
                                <div className="bg-white/20 p-2 rounded-xl"><Icon name="Smartphone" /></div>
                                <div>
                                    <p className="font-bold text-xs">Install App</p>
                                    <p className="text-[10px] opacity-80">Access tracker from your home screen</p>
                                </div>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowInstallBanner(false)} className="px-3 py-1.5 text-[10px] font-bold uppercase">Maybe Later</button>
                                <button onClick={handleInstallClick} className="bg-white text-blue-900 px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase">Install</button>
                            </div>
                        </div>
                    )}

                    <main className="flex-1 p-4 space-y-5">
                        {activeTab === 'dashboard' && (
                            <div className="space-y-5 animate-in">
                                <div className="bg-blue-900 rounded-2xl p-5 text-white shadow-lg">
                                    <div className="relative z-10">
                                        <p className="text-[9px] font-bold opacity-70 uppercase tracking-widest mb-0.5">Hockey Player</p>
                                        <h2 className="text-xl font-extrabold">{profile.name}</h2>
                                        <div className="flex gap-2 mt-3">
                                            <div className="bg-white/10 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider">{profile.position}</div>
                                            <div className="bg-white/10 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider">#{profile.jerseyNumber}</div>
                                        </div>
                                    </div>
                                </div>

                                <div className={`p-3 rounded-xl flex gap-2.5 items-center border border-transparent ${recoveryInsight.color}`}>
                                    <Icon name={recoveryInsight.icon} className="w-4 h-4" />
                                    <p className="text-[11px] font-bold">{recoveryInsight.text}</p>
                                </div>

                                <div className="space-y-2.5">
                                    <h3 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1">Recent Activity</h3>
                                    {logs.slice(0, 3).map(log => <LogItem key={log.id} log={log} onDelete={deleteLog} />)}
                                    {logs.length === 0 && <p className="text-center py-4 text-slate-300 text-xs italic">No activity yet</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div className="space-y-4 animate-in">
                                <div className="bg-white p-4 rounded-2xl border shadow-sm">
                                    <div className="flex justify-between items-center mb-3 px-1">
                                        <h3 className="font-extrabold text-xs uppercase text-slate-500">{viewDate.toLocaleString('default', { month: 'long', year: 'numeric' })}</h3>
                                        <div className="flex gap-1">
                                            <button onClick={()=>setViewDate(new Date(viewDate.setMonth(viewDate.getMonth()-1)))} className="p-1.5 hover:bg-slate-50 rounded-lg transition-colors"><Icon name="ChevronLeft" /></button>
                                            <button onClick={()=>setViewDate(new Date(viewDate.setMonth(viewDate.getMonth()+1)))} className="p-1.5 hover:bg-slate-50 rounded-lg transition-colors"><Icon name="ChevronRight" /></button>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-7 gap-0.5 text-center">
                                        {['S','M','T','W','T','F','S'].map(d => <span key={d} className="text-[9px] font-bold text-slate-300 py-1">{d}</span>)}
                                        {Array.from({ length: new Date(viewDate.getFullYear(), viewDate.getMonth(), 1).getDay() }).map((_, i) => <div key={`empty-${i}`} />)}
                                        {Array.from({ length: new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 0).getDate() }).map((_, i) => {
                                            const day = i + 1;
                                            const dStr = `${viewDate.getFullYear()}-${String(viewDate.getMonth()+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                                            const hasLog = logs.some(l => l.date === dStr);
                                            const isSelected = selectedDate === dStr;
                                            const isToday = dStr === new Date().toISOString().split('T')[0];
                                            return (
                                                <button key={day} onClick={()=>setSelectedDate(dStr)} className={`aspect-square rounded-lg text-xs font-bold flex flex-col items-center justify-center relative ${isSelected ? 'bg-blue-900 text-white' : isToday ? 'text-blue-600 bg-blue-50' : 'text-slate-700 hover:bg-slate-50'}`}>
                                                    {day}
                                                    {hasLog && <div className={`w-1 h-1 rounded-full absolute bottom-1 ${isSelected ? 'bg-white' : 'bg-blue-400'}`} />}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <h4 className="text-[10px] font-bold text-slate-400 uppercase px-1">Activity for {selectedDate}</h4>
                                    {logs.filter(l => l.date === selectedDate).map(log => <LogItem key={log.id} log={log} onDelete={deleteLog} />)}
                                    {logs.filter(l => l.date === selectedDate).length === 0 && <p className="text-center py-4 text-slate-300 text-[11px] italic">Rest day</p>}
                                </div>
                            </div>
                        )}

                        {activeTab === 'analysis' && (
                            <div className="space-y-5 animate-in">
                                <div className="bg-white p-6 rounded-3xl border shadow-sm text-center">
                                    <h3 className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Weekly Goal Progress</h3>
                                    <div className="relative w-28 h-28 mx-auto flex items-center justify-center mb-4">
                                        <svg className="w-full h-full -rotate-90">
                                            <circle cx="56" cy="56" r="50" stroke="#f1f5f9" strokeWidth="8" fill="none" />
                                            <circle cx="56" cy="56" r="50" stroke="#1e3a8a" strokeWidth="8" fill="none" strokeDasharray="314.15" strokeDashoffset={314.15 - (314.15 * weeklyProgress.percent) / 100} strokeLinecap="round" className="transition-all duration-700" />
                                        </svg>
                                        <div className="absolute text-xl font-black text-blue-900">{Math.round(weeklyProgress.percent)}%</div>
                                    </div>
                                    <p className="text-lg font-extrabold text-blue-900">{weeklyProgress.mins} / {profile.weeklyGoal}m</p>
                                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Minutes logged this week</p>
                                </div>

                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-white p-3.5 rounded-2xl border shadow-sm text-center">
                                        <p className="text-[9px] font-bold text-slate-400 uppercase">Sessions</p>
                                        <p className="text-lg font-black text-blue-900">{logs.length}</p>
                                    </div>
                                    <div className="bg-white p-3.5 rounded-2xl border shadow-sm text-center">
                                        <p className="text-[9px] font-bold text-slate-400 uppercase">Avg Mins</p>
                                        <p className="text-lg font-black text-blue-900">
                                            {logs.length ? Math.round(logs.reduce((a,c)=>a+c.duration,0)/logs.length) : 0}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'profile' && (
                            <div className="space-y-5 animate-in pb-4">
                                <section className="space-y-3">
                                    <h2 className="text-sm font-black px-1 uppercase tracking-wider text-slate-500">Athlete Profile</h2>
                                    <div className="bg-white p-5 rounded-2xl border space-y-4 shadow-sm">
                                        <div className="space-y-1">
                                            <label className="text-[9px] font-bold text-slate-400 uppercase ml-1">Full Name</label>
                                            <input className="w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100 focus:ring-blue-900" value={profile.name} onChange={e=>setProfile({...profile, name: e.target.value})} />
                                        </div>
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase ml-1">Position</label>
                                                <select className="w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100" value={profile.position} onChange={e=>setProfile({...profile, position: e.target.value})}>
                                                    {['Forward','Midfielder','Defender','Goalkeeper','Utility'].map(p => <option key={p} value={p}>{p}</option>)}
                                                </select>
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase ml-1">Jersey #</label>
                                                <input className="w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100" value={profile.jerseyNumber} onChange={e=>setProfile({...profile, jerseyNumber: e.target.value})} />
                                            </div>
                                        </div>
                                        <div className="space-y-2 pt-1">
                                            <div className="flex justify-between items-center px-1">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase">Weekly Goal</label>
                                                <span className="text-xs font-black text-blue-900">{profile.weeklyGoal}m</span>
                                            </div>
                                            <input type="range" min="60" max="600" step="30" value={profile.weeklyGoal} onChange={e=>setProfile({...profile, weeklyGoal: parseInt(e.target.value)})} className="w-full" />
                                        </div>
                                    </div>
                                </section>

                                <section className="space-y-3">
                                    <h2 className="text-sm font-black px-1 uppercase tracking-wider text-slate-500">App Settings</h2>
                                    <div className="bg-white p-3 rounded-2xl border space-y-1 shadow-sm">
                                        {(!window.matchMedia('(display-mode: standalone)').matches) && (
                                            <button onClick={handleInstallClick} className="w-full flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors text-blue-900">
                                                <div className="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center"><Icon name="Smartphone" /></div>
                                                <div className="text-left flex-1">
                                                    <p className="font-bold text-xs">Install App</p>
                                                    <p className="text-[9px] text-slate-400">Add to home screen</p>
                                                </div>
                                                <Icon name="Plus" className="w-3 h-3" />
                                            </button>
                                        )}
                                        <button onClick={exportData} className="w-full flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors">
                                            <div className="w-8 h-8 rounded-lg bg-slate-50 text-slate-600 flex items-center justify-center"><Icon name="Download" /></div>
                                            <div className="text-left flex-1">
                                                <p className="font-bold text-xs">Export Backup</p>
                                                <p className="text-[9px] text-slate-400">Download .json data</p>
                                            </div>
                                            <Icon name="ChevronRight" className="text-slate-300 w-3 h-3" />
                                        </button>
                                        <button onClick={() => fileInputRef.current.click()} className="w-full flex items-center gap-3 p-3 hover:bg-slate-50 rounded-xl transition-colors">
                                            <div className="w-8 h-8 rounded-lg bg-emerald-50 text-emerald-900 flex items-center justify-center"><Icon name="Upload" /></div>
                                            <div className="text-left flex-1">
                                                <p className="font-bold text-xs">Restore Backup</p>
                                                <p className="text-[9px] text-slate-400">Upload .json data</p>
                                            </div>
                                            <Icon name="ChevronRight" className="text-slate-300 w-3 h-3" />
                                        </button>
                                        <input type="file" ref={fileInputRef} onChange={importData} accept=".json" className="hidden" />
                                        <div className="pt-2 px-1">
                                            <button onClick={resetAllData} className="w-full p-2.5 text-rose-500 rounded-xl font-bold text-[10px] uppercase hover:bg-rose-50 transition-colors border border-rose-100">
                                                Wipe Local Storage
                                            </button>
                                        </div>
                                    </div>
                                </section>
                                <p className="text-center text-[9px] font-bold text-slate-300 uppercase pb-6">Version 2.3.1-PWA</p>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-5 left-4 right-4 max-w-md mx-auto bg-white/95 backdrop-blur-sm border rounded-2xl px-2 py-1.5 flex justify-around items-center shadow-lg z-[60]">
                        <NavBtn active={activeTab === 'dashboard'} onClick={()=>setActiveTab('dashboard')} icon="Home" />
                        <NavBtn active={activeTab === 'history'} onClick={()=>setActiveTab('history')} icon="Calendar" />
                        <button onClick={()=>setShowAddModal(true)} className="bg-blue-900 text-white w-10 h-10 rounded-xl flex items-center justify-center shadow-md active:scale-90 transition-all mx-1"><Icon name="Plus" className="w-5 h-5" /></button>
                        <NavBtn active={activeTab === 'analysis'} onClick={()=>setActiveTab('analysis')} icon="PieChart" />
                        <NavBtn active={activeTab === 'profile'} onClick={()=>setActiveTab('profile')} icon="Settings" />
                    </nav>

                    {showAddModal && (
                        <div className="fixed inset-0 bg-slate-900/40 backdrop-blur-[2px] z-[100] flex items-end sm:items-center justify-center p-4">
                            <div className="bg-white w-full max-sm:rounded-t-3xl sm:rounded-3xl p-6 space-y-4 animate-in">
                                <div className="flex justify-between items-center">
                                    <h2 className="text-sm font-black uppercase tracking-widest text-slate-500">Log Activity</h2>
                                    <button onClick={()=>setShowAddModal(false)} className="p-1 text-slate-300"><Icon name="X" /></button>
                                </div>
                                <div className="grid grid-cols-3 gap-2">
                                    {EXERCISE_TYPES.map(t => (
                                        <button key={t.id} onClick={()=>setNewLog({...newLog, type:t.id})} className={`p-2 rounded-xl border flex flex-col items-center gap-1 transition-all ${newLog.type === t.id ? 'border-blue-900 bg-blue-50 text-blue-900' : 'border-slate-100 bg-slate-50 text-slate-400'}`}>
                                            <span className="text-base">{t.icon}</span>
                                            <span className="text-[9px] font-bold uppercase">{t.name}</span>
                                        </button>
                                    ))}
                                </div>
                                <div className="space-y-3">
                                    <div className="space-y-1">
                                        <label className="text-[9px] font-bold text-slate-400 uppercase ml-1">Date</label>
                                        <input type="date" className="w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100" value={newLog.date} onChange={e=>setNewLog({...newLog, date: e.target.value})} />
                                    </div>
                                    {newLog.type !== 'rest' && (
                                        <div className="grid grid-cols-2 gap-3">
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase ml-1">Duration (Mins)</label>
                                                <input type="number" className="w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100" placeholder="0" value={newLog.duration} onChange={e=>setNewLog({...newLog, duration:e.target.value})} />
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[9px] font-bold text-slate-400 uppercase ml-1">Intensity</label>
                                                <select className="w-full p-3 bg-slate-50 rounded-xl text-xs font-bold border-none ring-1 ring-slate-100" value={newLog.intensity} onChange={e=>setNewLog({...newLog, intensity:e.target.value})}>
                                                    {INTENSITY_LEVELS.map(i=><option key={i.id} value={i.id}>{i.name}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <button onClick={addLog} className="w-full bg-blue-900 text-white p-3.5 rounded-xl font-black shadow-lg uppercase text-[11px] tracking-widest mt-2 active:scale-95 transition-transform">Save Activity</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const NavBtn = ({ active, onClick, icon }) => (
            <button onClick={onClick} className={`p-2.5 rounded-xl transition-all ${active ? 'bg-blue-900 text-white shadow-sm' : 'text-slate-300 hover:text-blue-900'}`}>
                <Icon name={icon} className="w-5 h-5" />
            </button>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
